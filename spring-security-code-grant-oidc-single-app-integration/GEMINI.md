# Gemini Spring Boot Development Guidelines

This document outlines the conventions, best practices, and standard procedures for developing and maintaining this Spring Boot application.

## 1. Project Structure

- **`src/main/java`**: Application source code.
    - **`com.springboot.project`**: Root package.
        - **`config`**: Configuration classes (Security, WebMvc, OpenAPI, etc.).
        - **`controller`**: REST controllers (REST API endpoints).
        - **`entity`**: JPA entities (Database models).
        - **`exception`**: Custom exceptions.
        - **`handler`**: Global exception handlers.
        - **`mapper`**: MapStruct mappers for entity-DTO conversion.
        - **`model`**: Business models and internal data structures.
        - **`repository`**: Spring Data JPA repositories.
        - **`service`**: Business logic services.
        - **`shared`**: Shared utility classes (e.g., `SpecificationHelper`).
- **`src/generated/java`**: Code generated by OpenAPI Generator (Models and API Interfaces). **Do not modify these files manually.**
- **`src/main/resources`**:
    - **`application.yaml`**: Main application configuration.
    - **`db/migration`**: Flyway SQL migration scripts.
    - **`openapi/open-api.yaml`**: OpenAPI specification file.

## 2. API Development Workflow (Contract-First)

This project follows a **Contract-First** approach using OpenAPI.

1.  **Define API**: Edit `src/main/resources/openapi/open-api.yaml`.
2.  **Generate Code**: Run `mvn clean compile` to generate the API interfaces and models in `src/generated/java`.
3.  **Implement API**: Create or update a Controller class in `src/main/java/com/springboot/project/controller/` that implements the generated API interface.
4.  **Map Models**: Use MapStruct in `src/main/java/com/springboot/project/mapper/` to map between generated DTOs and JPA Entities.

## 3. Database & Migrations

- **Flyway** is used for database migrations.
- **Naming Convention**: `V{Version}__{Description}.sql` (e.g., `V1_0_20231215223800__initial_table.sql`).
- Place new migration scripts in `src/main/resources/db/migration/`.
- Ensure proper indexing on columns used for filtering and sorting.

## 4. Coding Standards

### General
- **Java Version**: 17
- **Framework**: Spring Boot 3.x.x
- **Style**: Standard Java conventions. Use meaningful variable and method names.
- **Lombok**: Use Lombok annotations (`@Getter`, `@Setter`, `@Builder`, etc.) to reduce boilerplate code.

### Security
- **Spring Security**: Configured in `SecurityConfig.java`.
- **Authentication**: OAuth2 / OIDC using cookie-based state storage (`HttpCookieOAuth2AuthorizationRequestRepository`).
- **CSRF**: Protection enabled with `CsrfCookieFilter`.
- **Input Validation**: Use standard Bean Validation annotations (`@NotNull`, `@Size`, etc.) in OpenAPI spec and entities.

### Pagination & Filtering
- **Cursor Pagination**: Preferred for large datasets. Use `SpecificationHelper.cursorPagination`.
- **Specification Pattern**: Use `SpecificationHelper` for dynamic query construction.

### Error Handling
- **Global Handler**: `GlobalExceptionHandler` handles exceptions globally.
- **Response Format**: Errors return `ErrorResponseModel` with timestamp, status, message, and path.
- **Custom Exceptions**: Use `ResourceNotFoundException` for missing resources.

### Web Configuration
- **Angular Integration**: `WebMvcConfig` configures resource handlers for private and public Angular applications.
- **API Prefix**: REST controllers are prefixed with the base path defined in `ApplicationProperty`.

## 5. Testing

- **Unit Tests**: Use JUnit 5 and Mockito. **Never mock mapper classes.**
- **Integration Tests**: Use `@SpringBootTest` with Testcontainers (if applicable) or H2 for database integration testing.
- **Structure**: Mirror the `src/main/java` package structure in `src/test/java`.

## 6. Build & Run

- **Build**: `mvn clean package`
- **Run**: `mvn spring-boot:run` or `java -jar target/*.jar`
- **Skip Tests**: `mvn clean install -DskipTests` (Use with caution).

## 7. Common Tasks

### Adding a New Entity
1.  Create the Entity class in `entity` package extending `BaseEntity`.
2.  Create a Repository interface in `repository` extending `JpaRepository` and `JpaSpecificationExecutor`.
3.  Create a SQL migration script for the new table.

### Adding a New Endpoint
1.  Define the endpoint in `open-api.yaml`.
2.  Run `mvn compile`.
3.  Implement the logic in `Service` layer.
4.  Implement the endpoint in `Controller` layer.

## 8. Troubleshooting

- **Compilation Errors**: Check `src/generated/java` to ensure models are generated correctly. Run `mvn clean compile`.
- **Database Issues**: Check Flyway migration history table.
